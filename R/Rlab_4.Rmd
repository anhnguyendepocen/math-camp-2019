---
title: 'R Lab 4: Introduction to Data Analysis with R'
author: "Ikuma Ogura"
institution: "Georgetown University"
date: "August 23, 2019"
fontsize: 10pt
output: 
  beamer_presentation:
    theme: Boadilla
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Today

- Introduction to

    - loading data into R
    - data preprocessing with R
    - data summarization with R

## Datasets We Use Today

- Ideology score of U.S. legislators for the 115th Congress

    - `HS115_members.csv.csv`
    - https://voteview.com/data

\smallskip

- Ideology score of countries using United Nations General Assembly votes

    - `IdealpointsPublished.dta`
    - https://dataverse.harvard.edu/dataset.xhtml?persistentId=hdl:1902.1/12379
    
\smallskip

- Sushi preference survey data

    - `sushi_preference.csv`
    - Codebook: `sushi_preference_codebook.pdf`
    - http://www.kamishima.net/sushi/

## Package

- A collection of functions, data, and documentations which is publicly shared to enhance the functionality of R.

\smallskip

- Install packages if your R environment does not have them with `install.packages()` command.

    - Your computer must be connected to the Internet
    
\smallskip

- Call packages you want to use with `library()` or `require()` commands.


## Package: Example

```{r, tidy = FALSE, message = FALSE}
# Install packages
# Install.packages("haven")
# install.packages("readr")

# Load packages
require(haven)
require(readr)
```


## Loading Dataset in R: Working Directory

- It is recommended that you store all the data use use in the **working directory**

\smallskip

- Working directory: the directory (folder) that R refers to in reading and storing information

\smallskip

- To check where the current working directory is, type `getwd()` in the console. To change the working directory, use `setwd()` command.

\smallskip

- Example
```{r, tidy = FALSE, eval = FALSE}
setwd("C:/Users/ikuma/Documents/math-camp-2019/R")
```

## Loading Dataset in R

- How to load datasets into R's workspace depends on the file type of the data.

\smallskip

- Examples

    - .csv (comma-separated) files: use `read.csv()` function or `read_csv()` function in `readr` package 
    - .dta files (file format for data created with Stata): use `read.dta()` function in `foreign` package or `read_dta()` command in `haven` package
    - .por/.sav files (file format for data created with SPSS): use `read.spss()` function in `foreign` package or `read_spss()` command in `haven` package
    - Excel (.xlsx/.xls) files: use `read_excel()` command in `readxl` package

## Loading Dataset in R: Example

```{r, tidy = FALSE, message = FALSE}
# Read .csv file
voteview <- read_csv("HS115_members.csv")

# Read .dta file
UNideal <- read_dta("IdealpointsPublished.dta")
```

## How the Data Look Like

- Rows: observations

- Columns: variables

![Voteview dataset](dataset_example.png)

## data.frame Object

- If we load datasets using commands like `read_csv`, the corresponding objects will be of the `data.frame` class.

```{r}
# Let's check
class(voteview)
```

\smallskip

- `data.frame` objects are two-dimensional arrays in which column vectors (= variables) are bound together, often of different types.


## Accessing Variables in the Dataset

- How to access variables in a `data.frame` object?

\smallskip

- To call variables within a `data.frame`, we use `$` to write `dfname$varname`.

\smallskip

- Since each variable is a vector, we can access its elements using `[]`

\smallskip

- Example

```{r, tidy = FALSE}
# 2nd - 5th observations of nominate_dim1 variable 
voteview$nominate_dim1[c(2:5)]
```

## Accessing Variables in the Dataset (cont.)

- To access elements of a varialbe, we can also specify logical expressions

\smallskip

- Example

```{r, tidy = FALSE}
# Name of House Democrats in Arizona
voteview$bioname[voteview$chamber == "House" 
                 & voteview$state_abbrev == "AZ"
                 & voteview$party_code == 100]
# UN ideal points of US 1990 & 2007
UNideal$Idealpoint[UNideal$ccode == 2 
                   & (UNideal$year == 1990 | UNideal$year == 2007)]
```


## Creating New Variables

- It is often the case that the dataset does not contain the exact variables we want to use for analysis and it only includes variables that are closely related.

\smallskip

- In these cases, we need to create a new variable based on the information we have.

\smallskip

- Example

    - We would like to know the age of US legislators as of January 1, 2015.
    - We want to create a string variable representing the party affiliation of US legislators

## Creating New Variables (cont.)

- We can apply the knowledge learned so far so to do variable recodings!

\smallskip

- Example
```{r, tidy = FALSE}
# Age of US legislators
voteview$age <- 2015 - voteview$born
# String variable on the party affiliation
voteview$party_name <- "Democrat"
voteview$party_name[voteview$party_code == 200] <- "Republican"
voteview$party_name[voteview$party_code == 328] <- "Independent"
```

## ifelse() Function

- We can also use `ifelse()` function to do the same thing (and in a somewhat simpler way).

\smallskip

- `ifelse()` command;
\begin{block}{Usage}
ifelse(test, yes, no)
\end{block}
where
    - `test` is the logical expression
    - `yes` is the return value for elements in which `test` is `TRUE`
    - `no` is the return value for elements in which `test` is `FALSE`
    - (Therefore `ifelse()` returns a vector of the same length as `test`)

\smallskip

- Example

```{r, tidy = FALSE}
voteview$party_name <- 
  ifelse(voteview$party_code == 100, "Democract",
                              ifelse(voteview$party_code == 200, 
                                     "Republican", "Independent"))
```

## Summarizing Variables

- Examining how the variables are distributed

    - `summary()` for continuous variables
    - `table()` for discrete variables
    - `prop.table()` for tables entries in proportions

\smallskip

- Obtaining summary statistics

    - `mean()`, `median()`, `sd()`, `quantile()`...

## Summarizing Variables: Example

```{r, tidy = FALSE}
# Distribution of UN General Assembly ideal point
summary(UNideal$Idealpoint)
# Number of countries per each region in 2008
table(UNideal$unsc_region[UNideal$year == 2008])
# Crosstab of chamber and party
table(voteview$chamber, voteview$party_name)
```

## Summarizing Variables: Example (cont.)

```{r, tidy = FALSE}
# Proportion of countries by region in 2008
prop.table(table(UNideal$unsc_region[UNideal$year == 2008]))
# Party composition by chamber
prop.table(table(voteview$chamber, voteview$party_name),
           margin = 1)
```

## Missing Values in R

- In R, we represent missing values with `NA`

\smallskip

- Many functions (e.g., `mean()`) cannot conduct their operations if there are missing values

    - To circumvent the problem, we set the `na.rm` argument to `TRUE`
    
\smallskip

- Example

```{r, tidy = FALSE}
mean(voteview$nominate_dim1)
mean(voteview$nominate_dim1, na.rm = TRUE)
```

## Excercises!

- Compute the mean and the standard deviation of `nominate_dim1` variable for Democratic Senators and Republican House members, respectively.

\smallskip

- Calculate the differences in ideal points between US and Russia 1946-2015 and summarize the result

\smallskip

- For the sushi preference survey dataset,

    - read the dataset in R and name the object as `sushi.dat`.
    - create a variable `pref_same` which takes 1 when respondents live in the same prefectures as they were in 15 years old and 0 otherwise.
    - compare the distribution of most preferred sushi item (`itemID_1`) among men and women. Do you see any meaningful differences?

